PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE threads (id INTEGER PRIMARY KEY, topic TEXT, author TEXT, ctime DATETIME DEFAULT(DATETIME('NOW')), mtime DATETIME);
CREATE TABLE posts (id INTEGER PRIMARY KEY, thread INTEGER, post TEXT, author TEXT, ctime DATETIME DEFAULT(DATETIME('NOW')), mtime DATETIME, hidden INTEGER);
CREATE TRIGGER new_post AFTER INSERT ON posts
BEGIN
  UPDATE threads SET mtime = new.ctime WHERE id = new.thread;
END;
COMMIT;
